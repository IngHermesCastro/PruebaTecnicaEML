<!-- Alerta -->
<app-alert *ngIf="showAlert" [message]="alertMessage" [type]="alertType" (close)="closeAlert()">
</app-alert>

<div class="text-sm breadcrumbs mb-6">
    <ul>
        <li><a routerLink="/users" class="link link-hover">Usuarios</a></li>
        <li>Crear Usuario</li>
    </ul>
</div>

<!-- Tarjeta del Formulario -->
<div class="card bg-base-100 shadow-xl max-w-4xl mx-auto">
    <div class="card-body">

        <!-- Encabezado -->
        <div class="flex items-center gap-3 mb-4">
            <div class="avatar placeholder">
                <div class="bg-primary text-primary-content rounded-full w-12">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M19 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zM4 19.235v-.11a6.375 6.375 0 0112.75 0v.109A12.318 12.318 0 0110.374 21c-2.331 0-4.512-.645-6.374-1.766z" />
                    </svg>
                </div>
            </div>
            <div>
                <h2 class="card-title text-2xl">Crear Nuevo Usuario</h2>
                <p class="text-base-content/60">Completa el formulario para registrar un usuario</p>
            </div>
        </div>

        <div class="divider"></div>

        <!-- Formulario -->
        <form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="space-y-6">

            <!-- Grid Responsive: 1 columna en móvil, 2 en desktop -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                <!-- Campo: Nombres -->
                <div class="form-control w-full">
                    <label class="label">
                        <span class="label-text font-semibold">
                            Nombres <span class="text-error">*</span>
                        </span>
                    </label>
                    <input type="text" formControlName="nombres" placeholder="Ej: Juan Carlos"
                        class="input input-bordered w-full" [class.input-error]="hasError('nombres')"
                        [class.input-success]="userForm.get('nombres')?.valid && userForm.get('nombres')?.touched" />
                    <label class="label" *ngIf="hasError('nombres')">
                        <span class="label-text-alt text-error">
                            {{ getErrorMessage('nombres') }}
                        </span>
                    </label>
                </div>

                <!-- Campo: Apellidos -->
                <div class="form-control w-full">
                    <label class="label">
                        <span class="label-text font-semibold">
                            Apellidos <span class="text-error">*</span>
                        </span>
                    </label>
                    <input type="text" formControlName="apellidos" placeholder="Ej: Pérez García"
                        class="input input-bordered w-full" [class.input-error]="hasError('apellidos')"
                        [class.input-success]="userForm.get('apellidos')?.valid && userForm.get('apellidos')?.touched" />
                    <label class="label" *ngIf="hasError('apellidos')">
                        <span class="label-text-alt text-error">
                            {{ getErrorMessage('apellidos') }}
                        </span>
                    </label>
                </div>

            </div>

            <!-- Grid para Email y Teléfono -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                <!-- Campo: Email -->
                <div class="form-control w-full">
                    <label class="label">
                        <span class="label-text font-semibold">
                            Correo Electrónico <span class="text-error">*</span>
                        </span>
                    </label>
                    <div class="relative">
                        <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-base-content/40">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                                stroke="currentColor" class="w-5 h-5">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" />
                            </svg>
                        </span>
                        <input type="email" formControlName="email" placeholder="ejemplo@correo.com"
                            class="input input-bordered w-full pl-10" [class.input-error]="hasError('email')"
                            [class.input-success]="userForm.get('email')?.valid && userForm.get('email')?.touched" />
                    </div>
                    <label class="label" *ngIf="hasError('email')">
                        <span class="label-text-alt text-error">
                            {{ getErrorMessage('email') }}
                        </span>
                    </label>
                </div>

                <!-- Campo: Teléfono -->
                <div class="form-control w-full">
                    <label class="label">
                        <span class="label-text font-semibold">
                            Teléfono <span class="text-error">*</span>
                        </span>
                    </label>
                    <div class="relative">
                        <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-base-content/40">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                                stroke="currentColor" class="w-5 h-5">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z" />
                            </svg>
                        </span>
                        <input type="tel" formControlName="telefono" placeholder="3001234567"
                            class="input input-bordered w-full pl-10" [class.input-error]="hasError('telefono')"
                            [class.input-success]="userForm.get('telefono')?.valid && userForm.get('telefono')?.touched"
                            maxlength="15" />
                    </div>
                    <label class="label" *ngIf="hasError('telefono')">
                        <span class="label-text-alt text-error">
                            {{ getErrorMessage('telefono') }}
                        </span>
                    </label>
                    <label class="label" *ngIf="!hasError('telefono')">
                        <span class="label-text-alt text-base-content/60">
                            Solo números, entre 7 y 15 dígitos
                        </span>
                    </label>
                </div>

            </div>

            <div class="divider"></div>

            <!-- Estado del formulario -->
            <div class="alert" [class.alert-info]="userForm.invalid" [class.alert-success]="userForm.valid">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                    class="stroke-current shrink-0 w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <span *ngIf="userForm.invalid">Por favor, completa todos los campos correctamente</span>
                <span *ngIf="userForm.valid">✓ Formulario válido, listo para enviar</span>
            </div>

            <!-- Botones de Acción -->
            <div class="card-actions justify-end gap-3 flex-col sm:flex-row">

                <!-- Botón Cancelar -->
                <button type="button" class="btn btn-ghost btn-outline" routerLink="/users" [disabled]="isSubmitting">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" class="w-5 h-5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                    Cancelar
                </button>

                <!-- Botón Limpiar -->
                <button type="button" class="btn btn-warning" (click)="resetForm()"
                    [disabled]="isSubmitting || userForm.pristine">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" class="w-5 h-5">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
                    </svg>
                    Limpiar
                </button>

                <!-- Botón Guardar -->
                <button type="submit" class="btn btn-primary" [disabled]="userForm.invalid || isSubmitting">
                    <span *ngIf="!isSubmitting">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor" class="w-5 h-5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                        </svg>
                        Crear Usuario
                    </span>
                    <span *ngIf="isSubmitting" class="loading loading-spinner"></span>
                    <span *ngIf="isSubmitting">Guardando...</span>
                </button>

            </div>
            <div *ngIf="isSubmitting" class="loading-overlay">Cargando...</div>

        </form>

    </div>
</div>

<!-- Información adicional -->
<div class="alert alert-info mt-6 max-w-4xl mx-auto">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
    </svg>
    <div>
        <p class="font-semibold">Información importante:</p>
        <ul class="list-disc list-inside text-sm">
            <li>Todos los campos son obligatorios</li>
            <li>El correo electrónico debe ser único</li>
            <li>El teléfono solo acepta números (7-15 dígitos)</li>
            <li>Las fechas de registro y modificación se guardan automáticamente</li>
        </ul>
    </div>
</div>